<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>농산물 직거래 플랫폼 - 홈</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="소비자에게 신뢰할 수 있는 고품질 농산물을 제공하는 직거래 온라인 플랫폼">
  
  <!-- 외부 리소스 -->
  <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/common/home.css}">
</head>
<body>
  <!-- 네비게이션 바 -->
  <header class="navbar-container">
    <div class="navbar">
      <a th:href="@{/home}" class="logo-container">
        <img src="/images/free-icon-sprout-7101338.png" alt="농산물 직거래 플랫폼 로고" class="navbar-logo-img"/>
        <span class="brand-name">planT</span>
      </a>
      
      <div class="navbar-buttons">
        <!-- 구매자 로그인 상태 -->
        <th:block th:if="${buyerId != null}">
          <a th:href="@{/buyer/info}" class="btn-outline">
            <span th:text="${nickname}" style="font-weight: bold;"></span>
          </a>
          <a th:href="@{/buyer/cart/{bid}(bid=${buyerId})}" class="btn-outline">장바구니</a>
          <form th:action="@{/buyer/logout}" method="post" style="display:inline;">
            <button type="submit" class="btn-filled">로그아웃</button>
          </form>
        </th:block>
        
        <!-- 판매자 로그인 상태 -->
        <th:block th:if="${sellerId != null}">
          <a th:href="@{/seller/myPage/{sid}(sid=${sellerId})}" class="btn-outline">
            <span th:text="${nickname}" style="font-weight: bold;"></span>
          </a>
          <a th:href="@{/seller/main/{sid}(sid=${sellerId})}" class="btn-outline">대시보드</a>
          <form th:action="@{/seller/logout}" method="post" style="display:inline;">
            <button type="submit" class="btn-filled">로그아웃</button>
          </form>
        </th:block>

        <!-- 비로그인 상태 -->
        <th:block th:if="${buyerId == null and sellerId == null}">
          <a th:href="@{/common/select_login}" class="btn-outline">로그인</a>
          <a th:href="@{/common/select_signup}" class="btn-filled">회원가입</a>
        </th:block>
      </div>
    </div>
  </header>

  <!-- 메시지 표시 영역 -->
  <div th:if="${msg}" class="message-container">
    <div class="message-content">
      <span th:text="${msg}"></span>
      <button class="message-close" onclick="this.parentElement.parentElement.remove()">×</button>
    </div>
  </div>

  <!-- 메인 컨텐츠 영역 -->
  <main class="main-content">
    <!-- 히어로 섹션 -->
    <section class="hero-section">
      <div class="hero-container">
        <div class="hero-content">
          <h1 class="hero-title">소비자에게 신뢰할 수 있는 고품질 농산물을 제공하는 직거래 온라인 플랫폼</h1>
          <p class="hero-subtitle">농사를 즐겁게, 소비를 이롭게</p>
        </div>
      </div>
    </section>

    <!-- 검색 섹션 -->
    <section class="search-section">
      <div class="products-container">
        <div class="search-content">
          <h2 class="search-title">
            <i class="fas fa-search"></i> 상품 검색
          </h2>
          <div class="search-form-container">
            <div class="search-input-group">
              <input type="text" 
                     name="keyword" 
                     id="searchKeyword" 
                     class="search-input"
                     placeholder="상품명을 입력하세요..."
                     autocomplete="off">
              <button type="submit" class="search-button" onclick="goSearch()">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 인기상품 슬라이더 섹션 -->
    <section class="products-section" th:if="${not #lists.isEmpty(popularProducts)}">
      <div class="products-container">
        <h2 class="products-title">인기 상품</h2>
        <div class="popular-slider" id="popularSlider">
          <!-- 왼쪽 네비게이션 버튼 -->
          <div class="popular-nav-layer prev">
            <button class="popular-nav" onclick="movePopularSlider(-1)">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>
          
          <!-- 인기상품 컨텐츠 영역 -->
          <div class="popular-content-layer">
            <div class="popular-track">
              <div class="popular-page" th:each="chunk,stat : ${#numbers.sequence(0, (popularProducts.size()-1)/4)}">
                <a th:each="product,iter : ${popularProducts.subList(stat.index*4, T(java.lang.Math).min((stat.index+1)*4, popularProducts.size()))}"
                   th:href="@{/seller/product/{pid}(pid=${product.productId})}"
                   class="product-card"
                   th:title="${product.title}"
                   th:onclick="addToRecentProducts(${product.productId}, '${product.title}', '${product.thumbnail}', ${product.price}); return true;">
                  
                  <img th:src="${product.thumbnail}" 
                       th:alt="${product.title}"
                       class="product-image"
                       th:onerror="handleImageError(this)">
                  
                  <!-- 재고소진 상품 매진 표시 -->
                  <div th:if="${product.status == '재고소진'}" class="sold-out-overlay">
                    <span class="sold-out-text">매진</span>
                  </div>
                  
                  <div class="product-info">
                    <p class="product-title" th:text="${product.title}"></p>
                    <p class="product-price" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'"></p>
                  </div>
                </a>
              </div>
            </div>
            
            <!-- 슬라이더 점 표시 -->
            <div class="popular-dots" id="popularDots"></div>
          </div>
          
          <!-- 오른쪽 네비게이션 버튼 -->
          <div class="popular-nav-layer next">
            <button class="popular-nav" onclick="movePopularSlider(1)">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- 최신 상품 그리드 섹션 -->
    <section class="products-section">
      <div class="products-container">
        <h2 class="products-title">최신 상품</h2>
        <div class="products-grid" id="productsGrid">
          <!-- 상품이 없을 때 -->
          <div th:if="${#lists.isEmpty(products)}" class="loading">
            등록된 상품이 없습니다.
          </div>
          
          <!-- 상품 카드 -->
          <a th:each="product : ${products}"
             th:href="@{/seller/product/{pid}(pid=${product.productId})}"
             class="product-card"
             th:title="${product.title}"
             th:onclick="addToRecentProducts(${product.productId}, '${product.title}', '${product.thumbnail}', ${product.price}); return true;">
            
            <img th:src="${product.thumbnail}" 
                 th:alt="${product.title}"
                 class="product-image"
                 th:onerror="handleImageError(this)">
            
            <!-- 재고소진 상품 매진 표시 -->
            <div th:if="${product.status == '재고소진'}" class="sold-out-overlay">
              <span class="sold-out-text">매진</span>
            </div>
            
            <div class="product-info">
              <p class="product-title" th:text="${product.title}"></p>
              <p class="product-price" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'"></p>
            </div>
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- 최근 본 상품 사이드바 -->
  <section class="sidebar-section">
    <div class="sidebar-container">
      <aside class="recent-products-sidebar" id="recentProductsSidebar">
        <div class="recent-products-header">
          <h3 class="recent-products-title">
            <i class="fas fa-clock"></i> 최근 본 상품
          </h3>
          <button class="clear-recent-btn" onclick="clearRecentProducts()" title="최근 본 상품 모두 삭제">
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <div class="recent-products-list" id="recentProductsList">
          <!-- 최근 본 상품이 없을 때 -->
          <div class="no-recent-products">
            <i class="fas fa-eye-slash"></i>
            <p>최근 본 상품이 없습니다</p>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- JavaScript 파일 로드 -->
  <script th:src="@{/js/common/recent-products.js}"></script>
  <script th:src="@{/js/common/home.js}"></script>
</body>
</html>