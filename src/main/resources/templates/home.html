<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>농산물 직거래 플랫폼 - 홈</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="소비자에게 신뢰할 수 있는 고품질 농산물을 제공하는 직거래 온라인 플랫폼">
  <!-- Google Fonts: Cabin, Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/common/home.css}">
</head>
<body>
  <!-- 네비게이션 바 -->
  <header class="navbar-container">
    <div class="navbar">
      <a th:href="@{/home}" class="logo-container">
        <img src="/images/free-icon-sprout-7101338.png" alt="농산물 직거래 플랫폼 로고" class="navbar-logo-img"/>
        <span class="brand-name">planT</span>
      </a>
      <div class="navbar-buttons">
        <!-- 구매자 로그인 상태 -->
        <th:block th:if="${buyerId != null}">
          <a th:href="@{/buyer/info}" class="btn-outline">
            <span th:text="${nickname}" style="font-weight: bold;"></span>
          </a>
          <a th:href="@{/buyer/cart/{bid}(bid=${buyerId})}" class="btn-outline">장바구니</a>
          <a href="#" onclick="logout('buyer')" class="btn-filled">로그아웃</a>
        </th:block>
        
        <!-- 판매자 로그인 상태 -->
        <th:block th:if="${sellerId != null}">
          <a th:href="@{/seller/myPage/{sid}(sid=${sellerId})}" class="btn-outline">
            <span th:text="${nickname}" style="font-weight: bold;"></span>
          </a>
          <a th:href="@{/seller/main/{sid}(sid=${sellerId})}" class="btn-outline">대시보드</a>
          <a href="#" onclick="logout('seller')" class="btn-filled">로그아웃</a>
        </th:block>

        <!-- 비로그인 상태 -->
        <th:block th:if="${buyerId == null and sellerId == null}">
          <a th:href="@{/common/select_login}" class="btn-outline">로그인</a>
          <a th:href="@{/common/select_signup}" class="btn-filled">회원가입</a>
        </th:block>
      </div>
    </div>
  </header>

  <!-- 메시지 표시 영역 -->
  <div th:if="${msg}" class="message-container">
    <div class="message-content">
      <span th:text="${msg}"></span>
      <button class="message-close" onclick="this.parentElement.parentElement.remove()">×</button>
    </div>
  </div>

  <!-- 히어로 섹션 -->
  <section class="hero-section">
    <div class="hero-container">
      <div class="hero-content">
        <h1 class="hero-title">소비자에게 신뢰할 수 있는 고품질 농산물을 제공하는 직거래 온라인 플랫폼</h1>
        <p class="hero-subtitle">농사를 즐겁게, 소비를 이롭게</p>
      </div>
    </div>
  </section>

  <!-- 검색 섹션 -->
<!--  <section class="search-section">-->
<!--    <div class="products-container">-->
<!--      <div class="search-content">-->
<!--        <h2 class="search-title">-->
<!--          <i class="fas fa-search"></i> 상품 검색-->
<!--        </h2>-->
<!--        <div class="search-form-container">-->
<!--          <form action="/test/search" method="GET" class="search-form">-->
<!--            <div class="search-input-group">-->
<!--              <input type="text" name="keyword" class="search-input"-->
<!--                     placeholder="상품명을 입력하세요..."-->
<!--                     autocomplete="off">-->
<!--              <button type="submit" class="search-button">-->
<!--                <i class="fas fa-search"></i>-->
<!--              </button>-->
<!--            </div>-->
<!--          </form>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </section>-->

  <input type="text" id="searchKeyword" placeholder="검색어 입력">
  <button onclick="goSearch()">검색</button>

  <!-- 상품 그리드 섹션 -->
  <section class="products-section">
    <div class="products-container">
      <h2 class="products-title">최신 상품</h2>
      <div class="products-grid" id="productsGrid">
        <!-- 상품이 없을 때 -->
        <div th:if="${#lists.isEmpty(products)}" class="loading">
          등록된 상품이 없습니다.
        </div>
        
        <!-- 상품 카드 -->
        <a th:each="product : ${products}"
           th:href="@{/seller/product/{pid}(pid=${product.productId})}"
           class="product-card"
           th:title="${product.title}">
          <img th:src="${product.thumbnail}" 
               th:alt="${product.title}"
               class="product-image"
               th:onerror="this.src='/images/default-product.jpg'">
          
          <!-- 재고소진 상품에 매진 표시 -->
          <div th:if="${product.status == '재고소진'}" class="sold-out-overlay">
            <span class="sold-out-text">매진</span>
          </div>
          
          <div class="product-info">
            <p class="product-title" th:text="${product.title}"></p>
            <p class="product-price" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'"></p>
          </div>
        </a>
      </div>
    </div>
  </section>
<!--  <form action="test/copy/db" method="post">-->
<!--    <button type="submit">연동</button>-->
<!--  </form>-->

  <script th:src="@{/js/common/home.js}"></script>
  <script>
    function goSearch() {
      const keyword = document.getElementById('searchKeyword').value.trim();
      if (keyword) {
        // 검색 결과 페이지로 키워드를 쿼리 스트링으로 넘김
        window.location.href = `/search?keyword=${encodeURIComponent(keyword)}`;
      } else {
        alert('검색어를 입력하세요.');
      }
    }
  </script>
</body>
</html>